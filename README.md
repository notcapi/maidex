# Maidex - Asistente Personal Inteligente

Un asistente personal inteligente basado en Claude 3.5 Sonnet con integración de Model Context Protocol (MCP) para Gmail, Calendar y Google Drive.

## Características

- **Envío de correos electrónicos**: Integración directa con Gmail mediante MCP
- **Creación de eventos**: Agenda eventos en Google Calendar con comandos en lenguaje natural
- **Gestión de archivos**: Listado, búsqueda y descarga de archivos de Google Drive
- **Interfaz conversacional**: Chat intuitivo al estilo ChatGPT para interactuar con el asistente
- **Chat en tiempo real**: Sistema de mensajería en tiempo real con Supabase Realtime
- **Interfaz optimizada para móvil**: Diseño adaptable para dispositivos de cualquier tamaño
- **Entrada de voz**: Reconocimiento de voz integrado para dictar mensajes
- **Persistencia de conversaciones**: Historial guardado entre sesiones
- **Modo fallback**: Funcionamiento continuo incluso cuando Claude está sobrecargado
- **Referencias contextuales**: Entiende frases como "envía otro correo al mismo destinatario"
- **Despliegue en Vercel**: Listo para producción en la nube

## Mejoras en la interfaz de usuario

- **Diseño moderno**: Interfaz inspirada en ChatGPT con burbujas de chat, efectos de blur y animaciones fluidas
- **ChatInput mejorado**: Campo de texto autoexpandible con botón de envío animado
- **Acciones rápidas**: Chips de sugerencias para acciones comunes como "Enviar correo" o "Crear evento"
- **Reconocimiento de voz**: Botón de micrófono con indicadores visuales de grabación activa
- **Visualización de archivos**: Componente para mostrar archivos de Drive con iconos y opciones de descarga
- **Tema claro/oscuro**: Soporte completo para modo oscuro y claro con transiciones suaves
- **Responsive design**: Experiencia óptima tanto en escritorio como en dispositivos móviles
- **Actualizaciones en tiempo real**: Visualización instantánea de nuevos mensajes en todos los dispositivos conectados

## Estructura del Proyecto

```
maidex/
├── components/        # Componentes de UI reutilizables
│   ├── chat/          # Componentes relacionados con el chat (ChatInput, ChatBubble, etc.)
│   ├── drive/         # Componentes para visualización de archivos de Drive
│   ├── ui/            # Componentes de UI básicos (botones, inputs, etc.)
│   └── layout/        # Componentes de estructura y navegación
├── hooks/             # Hooks personalizados de React
│   └── useChatStream.ts  # Hook para gestionar el chat en tiempo real
├── lib/               # Utilidades y helpers compartidos
│   └── supabase.ts    # Cliente de Supabase
├── mcp/               # Implementación de Model Context Protocol para Gmail y Calendar
├── pages/             # Rutas de la aplicación Next.js
│   ├── api/           # Endpoints de la API (autenticación, chat, acciones MCP)
│   │   └── chat-stream.ts  # Endpoint para el chat en tiempo real
│   └── ...            # Páginas de la aplicación
├── public/            # Archivos estáticos
├── styles/            # Estilos CSS
├── supabase/          # Configuración y esquemas de Supabase
│   └── chat-schema.sql  # Esquema SQL para la tabla de mensajes
└── data/              # Almacenamiento local de conversaciones
```

## Requisitos

- Node.js v18+
- API Key de Anthropic (Claude)
- Proyecto OAuth de Google Cloud con acceso a Gmail, Calendar y Drive APIs
- Cuenta de Vercel (para despliegue)
- Cuenta de Supabase (para el chat en tiempo real)

## Configuración Local

1. Clonar el repositorio
   ```bash
   git clone https://github.com/notcapi/maidex.git
   cd maidex
   ```

2. Instalar dependencias
   ```bash
   npm install
   ```

3. Crear archivo `.env.local` con las siguientes variables:
   ```
   # Anthropic API
   ANTHROPIC_API_KEY=your_anthropic_api_key
   
   # NextAuth
   NEXTAUTH_SECRET=your_nextauth_secret
   NEXTAUTH_URL=http://localhost:3000
   
   # Google OAuth
   GOOGLE_CLIENT_ID=your_google_client_id
   GOOGLE_CLIENT_SECRET=your_google_client_secret
   
   # Supabase (para chat en tiempo real)
   NEXT_PUBLIC_SUPABASE_URL=https://tu-proyecto.supabase.co
   NEXT_PUBLIC_SUPABASE_ANON_KEY=tu-clave-anónima
   SUPABASE_SERVICE_KEY=tu-clave-de-servicio
   ```

4. Iniciar el servidor de desarrollo
   ```bash
   npm run dev
   ```

## Configuración de Supabase para Chat en Tiempo Real

### 1. Crear una nueva tabla en Supabase

Accede a tu proyecto en Supabase y crea una nueva tabla llamada `messages` con la siguiente estructura:

```sql
CREATE TABLE messages (
  id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  content TEXT NOT NULL,
  is_user BOOLEAN NOT NULL DEFAULT FALSE,
  user_id TEXT,
  conversation_id TEXT NOT NULL,
  created_at TIMESTAMPTZ NOT NULL DEFAULT NOW(),
  action TEXT,
  drive_files JSONB,
  file_id TEXT
);

-- Índices para mejorar el rendimiento
CREATE INDEX messages_conversation_id_idx ON messages (conversation_id);
CREATE INDEX messages_created_at_idx ON messages (created_at);
```

### 2. Habilitar Realtime para la tabla

1. En el panel de Supabase, ve a "Database" > "Replication"
2. En la sección "Realtime", haz clic en "Tables"
3. Busca la tabla `messages` y activa "Insert", "Update" y "Delete"
4. Guarda los cambios

## Despliegue en Vercel

1. **Crear cuenta en Vercel**: Regístrate en [vercel.com](https://vercel.com) si aún no tienes una cuenta.

2. **Instalar Vercel CLI** (opcional)
   ```bash
   npm install -g vercel
   ```

3. **Configurar archivo `vercel.json`** (ya incluido en el repositorio)
   ```json
   {
     "version": 2,
     "builds": [
       {
         "src": "package.json",
         "use": "@vercel/next"
       }
     ],
     "env": {
       "NEXTAUTH_URL": "${VERCEL_URL}"
     }
   }
   ```

4. **Desplegar el proyecto**
   ```bash
   # Iniciar sesión en Vercel
   vercel login
   
   # Desplegar
   vercel
   ```

5. **Configurar variables de entorno en Vercel**
   - Ve al panel de control de tu proyecto
   - Navega a "Settings" > "Environment Variables"
   - Añade todas las variables de `.env.local`
   - Asegúrate de configurar `NEXTAUTH_URL` como tu dominio de Vercel
   - Añade las variables de Supabase para el chat en tiempo real

6. **Configurar OAuth de Google**
   - Añade tu dominio de Vercel como URI de redirección autorizada en la consola de Google Cloud
   - Formato: `https://tu-proyecto.vercel.app/api/auth/callback/google`

## Uso del Chat en Tiempo Real

El hook `useChatStream` es el componente principal para interactuar con el sistema de chat en tiempo real:

```typescript
import { useChatStream } from '@/hooks/useChatStream';

function ChatComponent() {
  const { 
    messages, 
    isLoading, 
    error, 
    addMessage 
  } = useChatStream({
    conversationId: 'unique-conversation-id',
    initialMessages: [] // Mensajes iniciales opcionales
  });

  // Enviar un nuevo mensaje
  const sendMessage = (content) => {
    addMessage({
      content,
      isUser: true,
      // Otros campos opcionales...
    });
  };

  return (
    <div>
      {messages.map(msg => (
        <div key={msg.id}>
          {msg.content}
        </div>
      ))}
    </div>
  );
}
```

## Flujo de Datos del Chat en Tiempo Real

1. El usuario envía un mensaje utilizando `ChatInput`
2. El mensaje se guarda localmente a través del hook `useChatStream` con `addMessage`
3. El mensaje se envía al backend mediante la API correspondiente
4. El backend procesa el mensaje según la acción detectada
5. La respuesta se guarda en Supabase
6. Supabase envía la actualización en tiempo real a todos los clientes conectados
7. El hook `useChatStream` recibe la notificación y actualiza el estado
8. Los componentes de UI se actualizan automáticamente con los nuevos mensajes

## Solución de problemas con Supabase

Si experimentas problemas con la conexión en tiempo real:

1. Verifica que las variables de entorno están correctamente configuradas
2. Comprueba que Realtime está habilitado para la tabla `messages` en Supabase
3. Revisa las políticas de seguridad de Supabase (RLS) si es necesario
4. Consulta los logs de la aplicación para posibles errores

## Uso General de la Aplicación

1. Accede a la aplicación a través de tu navegador
2. Inicia sesión con tu cuenta de Google
3. Interactúa con el asistente mediante el chat
4. Comandos principales:
   - "Envía un correo a [correo] y dile [mensaje]"
   - "Crea un evento llamado [nombre] para mañana a las 10am"
   - "Lista mis archivos de Drive"
   - "Busca archivos PDF en mi Drive"

## Tecnologías utilizadas

- **Next.js**: Framework de React para aplicaciones web
- **Supabase**: Base de datos y backend para chat en tiempo real
- **Tailwind CSS**: Utilidades CSS para diseño rápido y responsive
- **Framer Motion**: Biblioteca para animaciones fluidas
- **NextAuth.js**: Autenticación para aplicaciones Next.js
- **TypeScript**: Tipado estático para desarrollo robusto
- **Claude API**: Modelo de lenguaje de Anthropic
- **Model Context Protocol**: Protocolo para integración segura con APIs

## Licencia

Este proyecto está licenciado bajo la licencia MIT. 